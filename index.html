<!doctype html>
<html lang="de">
  <head>
    <!-- g sgrength, dt, abcd -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>visuals</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.22/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tonal/browser/tonal.min.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <!-- <script src="/socket.io/socket.io.js"></script> -->

    <script src="config.js"></script>
    <script src="synths/bass.js"></script>
    <script src="synths/darkPad.js"></script>
    <script src="synths/proximityPad.js"></script>
    <script src="synths/proximityMelody.js"></script>
    <script src="synths/arpeggioHumSampler.js"></script>
    <script src="synths/abstractHumSampler.js"></script>
    <script src="synths/poemSampler.js"></script>
    <script src="visuals/getInitialCliffordState.js"></script>
    <script src="visuals/initAudio.js"></script>
    <script src="visuals/listenForOscMessages.js"></script>
    <script src="visuals/Visitor.js"></script>
    <script src="visuals/ResonanceSlice.js"></script>
    <script src="visuals.js"></script>

    <link rel="stylesheet" href="style.css" />
    <script>
      let audioReady = false;

      function requestFullscreen() {
        const documentElement = document.documentElement;
        if (documentElement.requestFullscreen) {
          documentElement.requestFullscreen();
        } else if (documentElement.webkitRequestFullscreen) {
          // Safari
          documentElement.webkitRequestFullscreen();
        } else if (documentElement.mozRequestFullScreen) {
          // Firefox
          documentElement.mozRequestFullScreen();
        }

        const startButton = document.getElementById("start");
        if (startButton) {
          startButton.style.display = "none";
        }
      }

      window.addEventListener("load", () => {
        
        const state = getInitialCliffordState()
        listenForOscMessages((positions) => updateVisitors(state, positions));

        const startButton = document.getElementById("start");

        startButton.addEventListener("click", async () => {
          console.log("Start button clicked", "audio ready?", audioReady);

          if (audioReady) {
            console.log("Audio already ready, entering fullscreen...");
            requestFullscreen();
          } else {
            initAudio(state).then((instruments) => {
              audioReady = true;
              console.log("Audio Initialized");

              initializeP5Sketch(instruments, state);

              requestFullscreen();
            });
          }
        });

        document.addEventListener("keydown", (e) => {
          if (e.key === "h" || e.key === "H") {
            if (startButton.style.display === "none") {
              startButton.style.display = "block";
            } else {
              startButton.style.display = "none";
            }
          }
        });
      });
    </script>
  </head>
  <body>
    <button id="start">Fullscreen</button>
    <div id="visuals"></div>
  </body>
</html>
